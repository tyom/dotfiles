# Clean environment for testing remote install
# Pinned for reproducible builds - check https://hub.docker.com/r/homebrew/brew/tags for updates
FROM homebrew/brew:4.6.20

ENV TERM=xterm-256color

# Install base packages (what a typical user might have)
USER root
RUN apt-get update -qq && \
  apt-get install -y stow vim locales zsh python3 && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/* && \
  localedef -i en_GB -f UTF-8 en_GB.UTF-8

# Switch back to linuxbrew user
USER linuxbrew
ENV HOME=/home/linuxbrew
WORKDIR ${HOME}

# Copy only docs folder for local HTTP server testing
COPY --chown=linuxbrew:linuxbrew docs /tmp/docs

# Copy the remote test entrypoint
COPY --chown=linuxbrew:linuxbrew scripts/docker-remote-entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
